rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Authentication helpers
    function isSignedIn() {
      return request.auth != null;
    }

		function isAdmin() {
      return isSignedIn() && request.auth.token.admin == true;
    }

		match /games/{gameId}/private {
    	allow read, write, update, delete: if isAdmin();
    }
    
		match /games/{gameId}/playerViews/{playerId} {
    	allow read, write, update: if request.auth.uid == playerId;
    }	
    
    match /games/{gameId} {
    	allow read: if isSignedIn();
    }
  	
    match /gameSummaries/{gameId} {
    	allow read: if isSignedIn();
    }

    match /games/{gameId}/chat/{messageId} {
      allow read: if isSignedIn();
    }

    //----------------------------------------------------------------------
    // Deny everything else
    //----------------------------------------------------------------------
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
